<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>D3 Test</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
		<script src="jquery-2.1.4.js" charset="utf-8"></script>
        <style type="text/css">
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
			
			svg path {
    			fill: none;
    			stroke-width: 2;
			}
			
			.block1 {
			    background: none;
                padding: 5px 20px 5px 5px;
                border: solid 1px black;
			    float: left;
			}
			
			.block2 {
				background: none;
                padding: 5px 20px 5px 5px;
                border: solid 1px black;
			    float: left;
			}

			.controls{
				padding: 10px;
			}

            .thresholdLine{
                cursor: ew-resize;
            }
		</style>
    </head>
    <body>
		<div class="controls">
			mean #1:<input id="mean1" type = "number" size = "20" id = "mean1" value = "0" onchange="draw()">
			mean #2:<input id="mean2" type = "number" size = "20" id = "mean2" value = "2" onchange="draw()">
			variance #1:<input id="var1" type = "number" size = "20" id = "var1" value = "4" onchange="draw()">
			variance #2:<input id="var2" type = "number" size = "20" id = "var2" value = "4" onchange="draw()">
		</div>
		<div id="renderer">

		</div>
        <script type = "text/javascript">
			// defining global constants
	        var w = 350., h = 350., padding = 30.;
	        var mean1 = 1., mean2 = 0., var1 = 2., var2 = 2.;

        
	        function erf(x) {
                var sign = (x >= 0) ? 1 : -1;
                x = Math.abs(x);

                // constants
                var a1 =  0.254829592;
                var a2 = -0.284496736;
                var a3 =  1.421413741;
                var a4 = -1.453152027;
                var a5 =  1.061405429;
                var p  =  0.3275911;

                var t = 1.0/(1.0 + p*x);
                var y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
                return sign * y; // erf(-x) = -erf(x);
            }

	        function cdf(x, mean, variance) {
                var normed_x = (x - mean) / (Math.sqrt(2 * variance));
                return 0.5 * (1 + erf(normed_x));
			}

	        function pdf(x, mean, variance) {
	        	return 1 / Math.sqrt(variance * 2 * Math.PI) * Math.exp(-(x - mean) * (x - mean) / 2. / variance);
	        }
	        
	        var threshold = (mean1 + mean2) / 2;
	        
	        var tMin = Math.min(mean1 - 3 * Math.sqrt(var1), mean2 - 3 * Math.sqrt(var2));
        	var	tMax = Math.max(mean1 + 3 * Math.sqrt(var1), mean2 + 3 * Math.sqrt(var2));
        	
        	var maxValue = Math.max(pdf(mean1, mean1, var1), pdf(mean2, mean2, var2)) * 1.05;

        	var xScaleDev = d3.scale.linear()
				.domain([tMin, tMax])
				.range([0. + padding, w + padding]);

			var yScaleDev = d3.scale.linear()
				.domain([0, maxValue])
				.range([h, 0]);

	        var xScale = d3.scale.linear()
        		.domain([0, 1])
        		.range([0., w]);

        	var yScale = d3.scale.linear()
        		.domain([0, 1])
        		.range([h, 0]);

        	var divar1  = d3.select("#renderer")
        		.append("div")
        		.attr("class", "block1");
        	
        	var svg = divar1
        		.append("svg")
        		.attr("width", w + padding)
       	 		.attr("height", h + padding);
        	
        	//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
        	//Create X axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + "," + h + ")")
				.call(xAxis);
			
			//Create Y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
			
			var roc_curve_line = d3.svg.line()
            	.x(function(d) {return xScale(1. - cdf(d, mean1, var1));})
            	.y(function(d) {return yScale(1. - cdf(d, mean2, var2));});
			
			var roc_curve_path = svg
				.append("path")
				.attr("class", "line");
			
			var circle = svg
				.append("circle")
				.attr("cx", xScale(1 - cdf(threshold, mean1, var1)))
				.attr("cy", yScale(1 - cdf(threshold, mean2, var2)))
				.attr("r", 4);
			
			//-------------------------------
        	var divar2 = d3.select("body")
    			.append("div")
    			.attr("class", "block2");
        	
        	var svg2 = divar2
        		.append("svg")
        		.attr("width", w + padding)
       	 		.attr("height", h + padding);
        	
        	var pdf_path1 = svg2
        		.append("path")
        		.attr("class","line")
                .attr("stroke", "red");
        	
        	var pdf_path2 = svg2
        		.append("path")
        		.attr("class", "line")
                .attr("stroke", "blue");
        	
        	var drag = d3.behavior.drag()
	        	.on("drag", function() {
	        		var thr = threshold + d3.event.dx * (tMax - tMin) / w;
		            threshold = Math.min(tMax, Math.max(thr, tMin));
		            d3.select(this).attr("x1", xScaleDev(threshold) + padding).attr("x2", xScaleDev(threshold) + padding);
		            circle
			            .attr("cx", xScale(1 - cdf(threshold, mean1, var1)))
						.attr("cy", yScale(1 - cdf(threshold, mean2, var2)));
	           });
        	
        	var thresholdLine = svg2.append("line")
                .call(drag)
                .attr('class', 'thresholdLine')
                .attr("stroke", "orange")
                .attr('stroke-width', '2');


			//Create X axis
			xAxDev = svg2.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + "," + h + ")");
			
			//Create Y axis
			yAxDev = svg2.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)");
							  
        	function draw(){
				// parsing arguments
				mean1 = parseFloat($('#mean1').val());
				mean2 = parseFloat($('#mean2').val());
				var1 = parseFloat($('#var1').val());
				var2 = parseFloat($('#var2').val());


	        	var thresholds = [];
	        	
	        	tMin = Math.min(mean1 - 3 * Math.sqrt(var1), mean2 - 3 * Math.sqrt(var2));
	        	tMax = Math.max(mean1 + 3 * Math.sqrt(var1), mean2 + 3 * Math.sqrt(var2));
	        	var N = 1000;
	        	var delta = (tMax - tMin) / N;

	        	thresholds[0] = tMin;
	        	for (var i = 1; i <= N; i++) {
	        		thresholds[i] = thresholds[i - 1] + delta;
	        	}
	        	
	        	maxValue = Math.max(pdf(mean1, mean1, var1), pdf(mean2, mean2, var2)) * 1.05;
	        		
	        	roc_curve_path
	        		.attr("d", roc_curve_line(thresholds))
	        		.attr("stroke", "green");

	        	xScaleDev = d3.scale.linear()
	    			.domain([tMin, tMax])
	    			.range([0. + padding, w + padding]);

	    		yScaleDev = d3.scale.linear()
	    			.domain([0, maxValue])
	    			.range([h, 0]);
	    		
	    		//Define X axis
				var xAxisDev = d3.svg.axis()
					.orient("bottom")
					.scale(xScaleDev)
				  	.ticks(5);

				//Define Y axis
				var yAxisDev = d3.svg.axis()
					.orient("left")
					.scale(yScaleDev)
					.ticks(5);		    		
	    		
	    		xAxDev.call(xAxisDev);
	    		yAxDev.call(yAxisDev);
				
				var deviation1 = d3.svg.line()
	        		.x(function(d) {return xScaleDev(d);})
	        		.y(function(d) {return yScaleDev(pdf(d, mean1, var1));});
	        	
	        	var deviation2 = d3.svg.line()
	    			.x(function(d) {return xScaleDev(d);})
	    			.y(function(d) {return yScaleDev(pdf(d, mean2, var2));});
	        	
	        	thresholdLine
		        	.attr("x1", xScaleDev(threshold))
		            .attr("y1", yScaleDev(0))
		            .attr("x2", xScaleDev(threshold))
		            .attr("y2", yScaleDev(maxValue));

	        	pdf_path1
	        		.attr("d", deviation1(thresholds));
	        	
	        	pdf_path2
        			.attr("d", deviation2(thresholds));
	        	
	        	circle
		        	.attr("cx", xScale(1 - cdf(threshold, mean1, var1)))
					.attr("cy", yScale(1 - cdf(threshold, mean2, var2)));
	        }
        	
        	draw();
        </script>
    </body>
</html>